(window["webpackJsonp_/@project/web_code"]=window["webpackJsonp_/@project/web_code"]||[]).push([[83],{"0OQi":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"canvas-wrapper"},[n("n-form",{staticClass:"page-form-wrapper",nativeOn:{submit:function(e){e.preventDefault()}}},[n("div",{staticClass:"page-canvas",class:{"is-dialog-show":e.isShowDialogCanvas||e.isShowTimerCanvas}},[e.isShowDialogCanvas||e.isShowTimerCanvas?n("div",{staticClass:"dialog-mask",class:{"is-show-modal":e.isShowModal||e.currentTimer}}):e._e(),e._v(" "),n(e.pageElement,e._b({key:e.pageProps.elementId,ref:e.pageProps.elementId,tag:"component",attrs:{"data-zone":e.pageProps.elementId+"_"+e.pageProps.elementType,id:"page_"+e.pageProps.elementId}},"component",e.pageProps,!1))],1)]),e._v(" "),n("div",{staticClass:"dialog-list"},[e.timerContainer?[n("div",{staticClass:"timer-area"},[e.timerContainer.children.length?e._l(e.timerContainer.children,(function(t){return n("el-tag",{key:t.elementId,staticClass:"dialog-item",class:{"is-active":e.currentTimer&&e.currentTimer.elementId===t.elementId},attrs:{size:"medium","data-zone":t.elementId+"_"+t.elementType},on:{click:function(n){return e.handleTimerClick(t)}}},[n("img",{staticClass:"iconfont",attrs:{src:e.$getImgPrefix(e.iconMap[t.elementType])}}),e._v("\n            "+e._s(e.getPropsByKey(t.elementId,"elementName")||t.elementName)+"\n            ")])})):n("div",{staticClass:"dialog-empty"},[e._v("定时器收纳区")])],2)]:e._e(),e._v(" "),e.dialogContainer?[n("div",{staticClass:"dialog-area"},[e.dialogContainer.children.length?e._l(e.dialogContainer.children,(function(t){return n("el-tag",{key:t.elementId,staticClass:"dialog-item",class:{"is-active":e.currentDialog&&e.currentDialog.elementId===t.elementId},attrs:{size:"medium","data-zone":t.elementId+"_"+t.elementType},on:{click:function(n){return e.handleDialogClick(t)}}},[n("img",{staticClass:"iconfont",attrs:{src:e.$getImgPrefix(e.iconMap[t.elementType])}}),e._v("\n            "+e._s(e.getPropsByKey(t.elementId,"elementName")||t.elementName)+"\n          ")])})):n("div",{staticClass:"dialog-empty"},[e._v("窗体收纳区")])],2)]:e._e()],2),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.hoverCoverStyle&&e.isShowHover,expression:"hoverCoverStyle && isShowHover"}],style:e.hoverCoverStyle,attrs:{id:"hover-cover"}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.placeholderStyle,expression:"placeholderStyle"}],style:e.placeholderStyle,attrs:{id:"drop-placeholder"}}),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:e.dropCoverStyle,expression:"dropCoverStyle"}],style:e.dropCoverStyle,attrs:{id:"drop-cover"}})],1)},i=[]},"5XML":function(e,t,n){},"5e7Y":function(e,t,n){"use strict";n.r(t);var a=n("0OQi"),i=n("w53y");for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);n("gART");var o=n("KHd+"),l=Object(o.a)(i.default,a.a,a.b,!1,null,"2247a401",null);t.default=l.exports},"90IP":function(e,t,n){"use strict";var a=n("TqRt"),i=n("cDf5");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("o0o1")),o=a(n("Ff2n")),l=a(n("HaE+")),d=a(n("ODXe")),c=a(n("rePB")),s=a(n("KQm4")),u=a(n("i7/w")),p=n("cCei"),m=a(n("YLtl")),g=n("0O+R"),f=n("ZDQs"),h=a(n("UBTA")),v=n("CDKT"),y=a(n("slWK")),I=a(n("WJ+c")),T=n("8SHQ"),D=n("tgb1"),b=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==i(e)&&"function"!=typeof e)return{default:e};var n=w(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=r?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(a,o,l):a[o]=e[o]}a.default=e,n&&n.set(e,a);return a}(n("ZQwl")),E=n("vu0G"),O=n("inkn"),S=n("xBdn"),P=n("7C5+"),C=n("7Qib"),_=n("uzoN"),x=["children"];function w(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(w=function(e){return e?n:t})(e)}function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var L={name:"PageCanvas",inject:["dndOptions"].concat((0,s.default)(P.pageInject)),provide:function(){var e=this;return{getCurrentDialog:function(){return e.currentDialog}}},data:function(){return{iconMap:f.iconMap,hoverCoverStyle:void 0,mouseEvent:{},placeholderStyle:void 0,dropCoverStyle:void 0,currentDialog:null,currentTimer:null}},computed:{dynamicProps:function(){return this.getStore().dynamicProps},layoutData:function(){return this.getStore().layoutData},pageElement:function(){var e=this.layoutData,t=e.elementType,n=e.elementVersion;return(0,D.getComponent)(t,n)},pageProps:function(){return N(N({},this.layoutData),this.getElementPropsById(this.layoutData.elementId))},dialogContainer:function(){return(0,g.getNodeByElementId)(this.layoutData,"dialog-container")},isShowDialogCanvas:function(){return this.currentDialog&&(!this.dndOptions.draggingWidget||this.dndOptions.draggingWidget&&!f.dialogTypes.includes(this.dndOptions.draggingWidget.elementType))},isShowTimerCanvas:function(){return this.currentTimer&&(!this.dndOptions.draggingWidget||this.dndOptions.draggingWidget&&"timer"!==this.dndOptions.draggingWidget.elementType)},isShowModal:function(){return!this.currentDialog||void 0===this.currentDialog.modal||this.currentDialog.modal},isShowHover:function(){var e=this.dndOptions,t=e.draggingWidget,n=e.resizingWidget,a=e.dndResizing,i=e.dndDragging;return!(t||n||a||i)},timerContainer:function(){return(0,g.getNodeByElementId)(this.layoutData,"timer-container")}},watch:{"dialogContainer.children":function(e){var t=this;this.currentDialog=e.find((function(e){return!1!==t.getElementPropsById(e.elementId).isVisible}))},"timerContainer.children":function(e){var t=this;this.currentTimer=e.find((function(e){return!1!==t.getElementPropsById(e.elementId).isVisible}))},isShowDialogCanvas:function(e){if(e){var t=document.querySelector(".page-canvas")||{};t.scrollTop=0,t.scrollLeft=0}},isShowTimerCanvas:function(e){if(e){var t=document.querySelector(".page-canvas")||{};t.scrollTop=0,t.scrollLeft=0}}},methods:{handleMouseEnterCanvas:m.default.throttle((function(e){if(e.stopPropagation(),this.dndOptions.draggingWidget||this.dndOptions.resizingWidget)this.mouseEvent=e;else{var t,n=e.target.dataset.zone;if(n){t=e.target;var a=n.split("_")[0];if("dialog-container"===a)return;this.dndOptions.hoverId=a}else{var i=e.path.find((function(e){var t;return null===(t=e.dataset)||void 0===t?void 0:t.zone}));i?(t=i,this.dndOptions.hoverId=i.dataset.zone.split("_")[0]):this.dndOptions.hoverId=""}if(t&&!t.classList.contains("no-hover")){var r=document.getElementById("app-design-page-main").getBoundingClientRect(),o=r.left,l=r.top,d=t.getBoundingClientRect(),c=d.left,s=d.top,u=d.width,p=d.height,m=c-o,g=s-l;this.hoverCoverStyle={top:"".concat(g-1,"px"),left:"".concat(m-1,"px"),width:"".concat(u+2,"px"),height:"".concat(p+2,"px")}}else this.hoverCoverStyle=void 0}}),60,{leading:!1,trailing:!0}),handleSelectWidget:function(e){e.stopPropagation();var t=e.target.dataset.zone;if(t){var n=t.split("_")[0];if("dialog-container"===n)return;this.dndOptions.selectedId=n}else{var a=e.path.find((function(e){var t;return null===(t=e.dataset)||void 0===t?void 0:t.zone}));a&&(this.dndOptions.selectedId=a.dataset.zone.split("_")[0])}},handleDialogClick:function(e){var t=this;this._storeCommit(p.TOGGLE_LAYOUT_VISIBLE,{elementId:e.elementId}),this.$nextTick((function(){setTimeout((function(){t.dndOptions.selectedId=e.elementId,t.$emit("selectedChanged")}),10)}))},handleTimerClick:function(e){var t=this;this._storeCommit(p.TOGGLE_LAYOUT_VISIBLE,{elementId:e.elementId}),this.$nextTick((function(){setTimeout((function(){t.dndOptions.selectedId=e.elementId,t.$emit("selectedChanged")}),10)}))},getPropsByKey:function(e,t){return this.getElementPropsById(e)[t]},isInForm:function(e){var t=(0,g.getParentNodeListByElementId)(this.layoutData,e);return t&&t.some((function(e){return["form-container"].includes(e.elementType)}))},isInSlot:function(e){var t=(0,g.getParentNodeByElementId)(this.layoutData,e);return t&&["slot"].includes(t.elementType)},isInGrid:function(e){var t=(0,g.getParentNodeByElementId)(this.layoutData,e);return t&&["grid-dnd"].includes(t.elementType)},handleInitDnD:function(){var e=this;document.addEventListener("mouseover",this.handleMouseEnterCanvas),document.addEventListener("click",this.handleSelectWidget),(0,h.default)(".is-accept-drag").draggable({ignoreFrom:".resize-handle",manualStart:!0,inertia:!1,autoScroll:!1,listeners:{move:function(e){e.target.style.left="".concat(e.clientX-50,"px"),e.target.style.top="".concat(e.clientY-10,"px")},end:function(){var e=document.querySelectorAll(".dragging-item");Array.prototype.slice.call(e).forEach((function(e){return e.remove()}))}}}).on("down",m.default.throttle((function(t){var n,a=null==t||null===(n=t.path)||void 0===n?void 0:n.some((function(e){var t;return null==e||null===(t=e.classList)||void 0===t?void 0:t.contains("is-ignore-drag")})),i=t.target.classList;i.contains("resize-handle")||i.contains("resize-handler")||i.contains("vue-resizable-handle")||a?e._mousedownTarget=null:(e._mousedownTarget=t.currentTarget,e._holding=!0,clearTimeout(e._holdTimer),e._holdTimer=setTimeout((function(){e._holding=!1}),30))}),20,{leading:!0,trailing:!1})).on("up",(function(){e._mousedownTarget=null,clearTimeout(e._holdTimer)})).on("move",(function(t){if(e._mousedownTarget&&!e._holding){var n=t.interaction;if(n.pointerIsDown&&!n.interacting()){if(e.dndOptions.resizingWidget)return;var a,i=t.currentTarget.dataset.zone.split("_"),r=(0,d.default)(i,4),o=r[0],l=r[1],c=r[2],s=r[3];if(o?a=(0,g.getNodeByElementId)(e.layoutData,e.dndOptions.selectedId):(a=e.dndOptions.widgets.find((function(e){return e.elementType===l})),c&&(a.templateId=c,a.elementName=s)),!a)return;e.dndOptions.draggingWidget=a;var u=f.ignoreDragTypes.includes(a.elementType),p=document.createElement("div");p.classList.add("is-accept-drag"),p.classList.add("dragging-item"),p.style.left="".concat(t.clientX0-50,"px"),p.style.top="".concat(t.clientY0-10,"px"),p.textContent=a.elementName;var m=document.querySelector(".app-design-page");m&&m.appendChild(p);var v=t.interactable,y=u?[]:g.getDropTargets.call(e,{layoutData:e.layoutData,draggingWidget:a,currentDialog:e.currentDialog,hasTree:e.dndOptions.hasTree,currentTimer:e.currentTimer});v.options.drag.modifiers=[h.default.modifiers.snap({targets:y})],n.start({name:"drag"},v,p),e.interaction=n,e.interactable=v}}})),(0,h.default)(".drop-zone").dropzone({accept:".is-accept-drag",overlap:"pointer",ondropmove:m.default.debounce((function(t){e.dropCoverStyle=void 0,e.placeholderStyle=void 0;var n=t.target.classList.contains("tree-node"),a=e.dndOptions;if(a.draggingWidget){var i=f.dialogTypes.includes(a.draggingWidget.elementType);if("timer"===a.draggingWidget.elementType||i){if(a.draggingWidget.elementId===a.selectedId)return;a.dropZoneId=i?e.dialogContainer.elementId:e.timerContainer.elementId,a.placement="center";var r=document.querySelector(".page-canvas").getBoundingClientRect(),o=r.left,l=r.top,c=r.width,s=r.height;e.placeholderStyle={width:"".concat(c,"px"),height:"".concat(s,"px"),left:"".concat(o,"px"),top:"".concat(l,"px")}}else{if((0,g.isInCanvas)({x:e.mouseEvent.clientX,y:e.mouseEvent.clientY,isDialog:i,hasTree:e.dndOptions.hasTree})){var u=t.target.dataset.zone.split("_"),p=(0,d.default)(u,2),m=p[0];p[1];if(!(0,g.isIncludes)(a.draggingWidget.children,m)){a.dropZoneId=m;var h,v=t.currentTarget.getBoundingClientRect(),y=v.left,I=v.top,T=v.width,D=v.height,b=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;return Math.abs(e-t)<n},E=b(t.dragEvent.clientX-1,y),O=b(t.dragEvent.clientX+1,y+T),S=b(t.dragEvent.clientY-1,I),P=b(t.dragEvent.clientY+1,I+D),C=b(t.dragEvent.clientY,I+D/2)&&b(t.dragEvent.clientX,y+T/2),_={};switch(!0){case E:h="left",_=n?{width:"".concat(T,"px"),height:"".concat(6,"px"),left:"".concat(y,"px"),top:"".concat(I,"px")}:{width:"".concat(6,"px"),height:"".concat(D,"px"),left:"".concat(y-6,"px"),top:"".concat(I,"px")};break;case O:h="right",_=n?{width:"".concat(T,"px"),height:"".concat(6,"px"),left:"".concat(y,"px"),top:"".concat(I+D-6,"px")}:{width:"".concat(6,"px"),height:"".concat(D,"px"),left:"".concat(y+T,"px"),top:"".concat(I,"px")};break;case S:h="top",_={width:"".concat(T,"px"),height:"".concat(6,"px"),left:"".concat(y,"px"),top:"".concat(I-6,"px")};break;case P:h="bottom",_={width:"".concat(T,"px"),height:"".concat(6,"px"),left:"".concat(y,"px"),top:"".concat(I+D,"px")};break;case C:h="center",_={width:"".concat(T,"px"),height:"".concat(D,"px"),left:"".concat(y,"px"),top:"".concat(I,"px")}}e.placeholderStyle=_,e.dropCoverStyle={top:"".concat(I,"px"),left:"".concat(y,"px"),width:"".concat(T,"px"),height:"".concat(D,"px")},a.placement=h}}}}}),20,{leading:!1,trailing:!0}),ondrop:function(t){return(0,l.default)(r.default.mark((function t(){var n,a,i,l,d,s,u,h,v,y,I,T,D,S,P,C,_,w,k;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=O.getGlobalConfig.call(e),a=e.dndOptions,i=a.dropZoneId,l=a.placement,d=e.dndOptions.draggingWidget,i&&l&&d){t.next=5;break}return t.abrupt("return");case 5:if(s=(0,g.getNodeByElementId)(e.layoutData,i),u=(0,g.getParentNodeByElementId)(e.layoutData,i),!f.ignoreDragTypes.includes(d.elementType)){t.next=10;break}return t.abrupt("return");case 10:if(d.elementId!==i){t.next=12;break}return t.abrupt("return");case 12:if(!(0,g.isIncludes)(d,i)){t.next=14;break}return t.abrupt("return");case 14:if(!e.isShowDialogCanvas||(0,g.isIncludes)(e.dialogContainer,s.elementId)){t.next=16;break}return t.abrupt("return");case 16:if((0,g.isInCanvas)({x:e.mouseEvent.clientX,y:e.mouseEvent.clientY,isDialog:e.isShowDialogCanvas,hasTree:e.dndOptions.hasTree})){t.next=19;break}return t.abrupt("return");case 19:if(!(h=d.templateId)){t.next=26;break}return t.next=23,e.syncSourceToApp(h);case 23:return t.next=25,e.getWidgetByTemplateId(h,s,l);case 25:d=t.sent;case 26:if(!d.elementId?(v=g.getResetIdWidget.call(e,d),g.treeUtil.forEach([v],(function(t){t.children;var n=(0,o.default)(t,x),a=N(N({},n),n.defaultProps||{});f.defaultKeys.forEach((function(t){e.$delete(a,t)})),e._storeCommit(p.INIT_DYNAMIC_PROPS,{elementId:n.elementId,props:m.default.cloneDeep(a)}),t.defaultEvents&&e._storeDispatch(p.INIT_EVENTS_DATA,{elementId:n.elementId,events:n.defaultEvents}),f.defaultKeys.forEach((function(n){e.$delete(t,n)}))}))):v=d,(f.dialogTypes.includes(v.elementType)||"timer"===v.elementType)&&g.treeUtil.forEach(e.layoutData.children,(function(t){!f.dialogTypes.includes(t.elementType)&&"timer"!==t.elementType||t.elementId===v.elementId||b.globalEmit.call(e,E.PROPS,{elementId:t.elementId,data:{isVisible:!1}})})),"center"!==l&&e.isInSlot(i)&&["data"].includes(e.getElementPropsById(u.elementId).slotType)&&e._storeCommit(p.UPDATE_DYNAMIC_PROPS,{dynamicProps:(0,c.default)({},v.elementId,{prop:e.getElementPropsById(u.elementId).slotName,useSlotProps:!0})}),"center"===l&&["data"].includes(e.getElementPropsById(s.elementId).slotType)&&e._storeCommit(p.UPDATE_DYNAMIC_PROPS,{dynamicProps:(0,c.default)({},v.elementId,{prop:e.getElementPropsById(s.elementId).slotName,useSlotProps:!0})}),f.formTypes.includes(v.elementType)&&e.isInForm(i)&&e._storeCommit(p.UPDATE_DYNAMIC_PROPS,{dynamicProps:(0,c.default)({},v.elementId,{useSlotProps:!0})}),!e.isInGrid(i)&&!["grid-dnd"].includes(s.elementType)){t.next=46;break}["grid-dnd"].includes(s.elementType)?(P=e.getElementPropsById(s.elementId),C=P.colNum,P.rowHeight,S=C):(_=e.getElementPropsById(u.elementId),w=_.colNum,_.rowHeight,S=w),k=e.getElementPropsById(s.elementId).layout||{},t.t0=l,t.next="bottom"===t.t0?38:"center"===t.t0?41:44;break;case 38:return T=k.x,D=k.y+k.h,t.abrupt("break",44);case 41:return T=0,D=0,t.abrupt("break",44);case 44:b.globalEmit.call(e,E.PROPS,{elementId:v.elementId,data:{layout:{i:v.elementId,x:T,y:D,w:(null===(y=e.getElementPropsById(v.elementId).layout)||void 0===y?void 0:y.w)||S,h:(null===(I=e.getElementPropsById(v.elementId).layout)||void 0===I?void 0:I.h)||6}},pushHistory:!1}),(e.isInGrid(i)&&"center"!==l||["grid-dnd"].includes(s.elementType)&&"center"===l)&&e._storeCommit(p.UPDATE_DYNAMIC_PROPS,{dynamicProps:(0,c.default)({},v.elementId,{styleConfigList:[{name:"根元素",query:"",styles:{overflowX:"auto",overflowY:"auto"},className:[],animation:[]}]})});case 46:if(g.insertElement.call(e,{rootTree:e.layoutData,targetId:i,placement:l,newNode:v,oldSelectedId:e.dndOptions.selectedId,pushHistory:!1}),!h){t.next=51;break}return t.next=50,e._storeDispatch(p.HANDLE_COPY,{elementId:v.elementId});case 50:e._storeDispatch(p.DELETE_LAYOUT_DATA,{elementId:v.elementId});case 51:setTimeout((function(){(0,O.update)({oldVal:{elementId:e.dndOptions.selectedId},val:{elementId:v.elementId},extra:{oldVal:n,val:O.getGlobalConfig.call(e)},callback:function(t){var n=t.elementId;setTimeout((function(){e.dndOptions.selectedId=n}),0)}}),e.dndOptions.selectedId=v.elementId,e.hoverCoverStyle=void 0}));case 52:case"end":return t.stop()}}),t)})))()},ondropdeactivate:m.default.throttle((function(t){t.relatedTarget.remove(),e.dropCoverStyle=void 0,e.placeholderStyle=void 0,e.dndOptions.draggingWidget=null,e.dndOptions.dropZoneId="",e.dndOptions.placement="",e.mouseEvent={};var n=new CustomEvent(v.DRAG_END_EVENT_NAME,{detail:!0});dispatchEvent(n)}),20,{leading:!1,trailing:!0})}).on("mousewheel",m.default.throttle((function(){e.hoverCoverStyle=void 0;var t=e.dndOptions.draggingWidget;t&&(e.interaction.stop(),e.$nextTick((function(){var n=f.ignoreDragTypes.includes(t.elementType)?[]:g.getDropTargets.call(e,{layoutData:e.layoutData,draggingWidget:t,currentDialog:e.currentDialog,hasTree:e.dndOptions.hasTree,currentTimer:e.currentTimer}),a=e.interactable;a.options.drag.modifiers=[h.default.modifiers.snap({targets:n})];var i=document.querySelector(".dragging-item");e.interaction.start({name:"drag"},a,i)})))}),200,{leading:!1,trailing:!0})),(0,h.default)(".is-resizable").resizable({allowFrom:".resize-handle",edges:{left:!1,right:!0,bottom:!1,top:!1},inertia:!1,listeners:{move:m.default.throttle((function(t){var n=e.dndOptions,a=n.resizingWidget,i=n.gridSize,r=n.offsetLeft;if(a){var o=t.clientX-r,l=Math.ceil(Math.abs(o)/i);l>12||l<1||(e.oldSpan||(e.oldSpan=l),a.span=l,b.globalEmit.call(e,E.PROPS,{elementId:a.elementId,data:{span:l},pushHistory:!1}))}}),20,{leading:!1,trailing:!0}),end:function(){var t=e.dndOptions.resizingWidget;t&&t.span&&((0,O.update)({oldVal:e.oldSpan,val:t.span,callback:function(n){b.globalEmit.call(e,E.PROPS,{elementId:t.elementId,data:{span:n},pushHistory:!1})}}),e.oldSpan=void 0,e.$nextTick((function(){e.dndOptions.resizingWidget=null})))}}}).on("down",(function(t){if(t.target.classList.contains("resize-handle")){var n=t.target.dataset.zone.split("_"),a=(0,d.default)(n,2),i=a[0],r=a[1];e.dndOptions.resizingWidget=(0,g.getNodeByElementId)(e.layoutData,i);var o=document.querySelector('.page-canvas [data-zone="'.concat(i,"_").concat(r,'"]')),l=(0,g.getParentNodeByElementId)(e.layoutData,i),c=document.querySelector('.page-canvas [data-zone="'.concat(l.elementId,"_").concat(l.elementType,'"]')).getBoundingClientRect().width,s=o.getBoundingClientRect().left;e.dndOptions.gridSize=Math.ceil(c/12),e.dndOptions.offsetLeft=s}})).on("up",(function(){e.dndOptions.resizingWidget=null})),h.default.dynamicDrop(!0)},handleUpdateLayoutData:function(e){var t=e.elementId,n=e.layout,a=this.getStore();g.treeUtil.forEach([a.layoutData],(function(e){e.elementId===t&&Object.keys(n).forEach((function(t){u.default.set(e,t,m.default.cloneDeep(n[t]))}))}))},getWidgetByTemplateId:function(e,t,n){var a,i=this,o=this.getStore().layoutData,d=t,c=(0,g.getParentNodeByElementId)(o,t.elementId),u=(0,g.getRandomHexadecimal)(12);a=c?Math.max.apply(Math,(0,s.default)(c.children.map((function(e){var t,n;return((null===(t=i.getElementPropsById(e.elementId).layout)||void 0===t?void 0:t.y)||0)+((null===(n=i.getElementPropsById(e.elementId).layout)||void 0===n?void 0:n.h)||0)}))).concat([0])):0;var m={elementId:u,elementType:"placeholder",elementName:"模板组件",elementVersion:"v1",children:[],defaultProps:{layout:{i:u,x:0,y:a,w:12,h:6}}};switch(n){case"top":case"left":g.treeUtil.insertBefore([o],m,d),this.handleUpdateLayoutData({elementId:c.elementId,layout:{children:c.children}});break;case"bottom":case"right":g.treeUtil.insertAfter([o],d,m),this.handleUpdateLayoutData({elementId:c.elementId,layout:{children:c.children}});break;case"center":d.children.push(m),this.handleUpdateLayoutData({elementId:d.elementId,layout:{children:d.children}})}if(e.includes(T.PUBLISH_TEMPLATE)){var f=I.default.find((function(t){return t.id===e})).config;return this.handleLoadTemplateData({config:f,currentNode:d,parentNode:c,layoutData:o,placement:n,bottom:a,placeholderId:u})}return new Promise((function(t,s){i.$http({url:y.default.componentTemplatePrivateDetail,data:{id:Number(e)}}).then(function(){var e=(0,l.default)(r.default.mark((function e(l){var s,p,m;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=l.data,p=s.config,e.next=4,i.handleLoadTemplateData({config:p,currentNode:d,parentNode:c,layoutData:o,placement:n,bottom:a,placeholderId:u});case 4:m=e.sent,t(m);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(){i.$message.error("组件模板加载失败"),s(),i._storeDispatch(p.DELETE_LAYOUT_DATA,{elementId:u})}))}))},handleSavePageVariable:function(e){return this.$http({url:y.default.appPageDesignSavePageConfig,data:[{pageDesignId:Number(this.getStore().layoutData.pageDesignId),type:4,config:JSON.stringify(e)}]})},handleGetAppVariables:function(){return this.$http({url:y.default.appVariablesList,data:{appDesignId:Number(this.$route.query.vid)}}).then((function(e){var t=e.data.map((function(e){return[e.name,{value:"string"==typeof e.defaultValue&&(0,S.isValidJsonString)(e.defaultValue)?JSON.parse(e.defaultValue):e.defaultValue,desc:e.description,key:e.name}]})),n=Object.fromEntries(t);(0,C.setAppVariables)(n)}))},handleSaveAppVariable:function(e){return this.$http({url:y.default.appVariablesSave,data:N(N({},e),{},{appDesignId:Number(this.$route.query.vid)})})},handleLoadTemplateData:function(e){var t=this;return(0,l.default)(r.default.mark((function n(){var a,i,o,l,d,c,u,f,h,y,I,T,D,b,E,O,S,P,x,w,k,L,A,B,z,W,V,M,U,j,R,$,H,Y;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=e.config,i=e.currentNode,o=e.parentNode,l=e.layoutData,d=e.placement,e.bottom,c=e.placeholderId,u=t.getStore(),f=JSON.parse(a),h=f.pageId?JSON.parse(a.replaceAll(f.pageId,t.getStore().layoutData.elementId)):f,I=(y=h).layout,T=y.events,D=y.props,b=y.functionsData,E=void 0===b?[]:b,O=y.jsData,S=void 0===O?[]:O,P=y.dialogs,x=y.timers,w=y.dynamicVariables,k=y.appVariables,L=I,A={},B={},z=[],W=u.functionsData.map((function(e){return e.id})),V=u.jsData.map((function(e){return e.id})),E.forEach((function(e){W.includes(e.id)||u.functionsData.push(e)})),S.forEach((function(e){V.includes(e.id)||u.jsData.push(e)})),!w){n.next=19;break}return M=t.getStore().layoutData.elementId,U=N(N({},t.getElementPropsById(M).dynamicVariables),w),n.next=18,t.handleSavePageVariable(U);case 18:A[M]={dynamicVariables:U};case 19:if(!k){n.next=27;break}return n.next=22,t.handleGetAppVariables();case 22:return j=(0,C.getAppVariables)(),R=[],Object.keys(k).forEach((function(e){if(!j[e]){var n=k[e];R.push(t.handleSaveAppVariable({defaultValue:"string"==typeof n.defaultValue?n.defaultValue:JSON.stringify(n.defaultValue),description:n.desc,name:e}))}})),n.next=27,Promise.all(R);case 27:g.treeUtil.forEach(u.layoutData.children,(function(e){z.push(e.elementId)})),P&&(g.treeUtil.forEach(P,(function(e){var t=e.elementId,n=e.elementType,a=(0,g.getRandomHexadecimal)(6),i=z.includes(t)?"".concat(n,"-").concat(a):t;e.elementId=i;var r=D[t]||{};Object.keys(e).forEach((function(t){void 0!==r[t]||void 0===e[t]||["children"].includes(t)||(r[t]=m.default.cloneDeep(e[t]))})),A[i]=N(N({},D[t]),{},{layout:D[t].layout?N(N({},D[t].layout),{},{i:i}):void 0,elementId:i}),B[i]=T[t]})),($=t.dialogContainer.children).push.apply($,(0,s.default)(P))),x&&(g.treeUtil.forEach(x,(function(e){var t=e.elementId,n=e.elementType,a=(0,g.getRandomHexadecimal)(6),i=z.includes(t)?"".concat(n,"-").concat(a):t;e.elementId=i;var r=D[t]||{};Object.keys(e).forEach((function(t){void 0!==r[t]||void 0===e[t]||["children"].includes(t)||(r[t]=m.default.cloneDeep(e[t]))})),A[i]=N(N({},D[t]),{},{layout:D[t].layout?N(N({},D[t].layout),{},{i:i}):void 0,elementId:i}),B[i]=T[t]})),(H=t.timerContainer.children).push.apply(H,(0,s.default)(x))),g.treeUtil.forEach([L],(function(e){var t=e.elementId,n=(e.elementType,(0,g.getRandomHexadecimal)(6),t);e.elementId=n;var a=D[t]||{};Object.keys(e).forEach((function(t){void 0!==a[t]||void 0===e[t]||["children"].includes(t)||(a[t]=m.default.cloneDeep(e[t]))})),A[n]=N(N({},D[t]),{},{layout:D[t].layout?N(N({},D[t].layout),{},{i:n}):void 0,elementId:n}),B[n]=T[t]})),Object.keys(A).forEach((function(e){var t=A[e];if(!t.styleConfigList){var n=m.default.cloneDeep(_.styleConfig);n.styles=t.styleName||{},n.styles.cssText=t.cssText||"",t.styleConfigList=[n]}})),u.dynamicProps=N(N({},u.dynamicProps),A),u.eventsData=N(N({},u.eventsData),B),n.t0=d,n.next="top"===n.t0||"left"===n.t0?37:"bottom"===n.t0||"right"===n.t0?40:"center"===n.t0?43:46;break;case 37:return g.treeUtil.insertBefore([l],L,i),t.handleUpdateLayoutData({elementId:o.elementId,layout:{children:o.children}}),n.abrupt("break",46);case 40:return g.treeUtil.insertAfter([l],i,L),t.handleUpdateLayoutData({elementId:o.elementId,layout:{children:o.children}}),n.abrupt("break",46);case 43:return i.children.push(L),t.handleUpdateLayoutData({elementId:i.elementId,layout:{children:i.children}}),n.abrupt("break",46);case 46:return t.handleUpdateLayoutData({elementId:"dialog-container",layout:{children:t.dialogContainer.children}}),t.handleUpdateLayoutData({elementId:"timer-container",layout:{children:t.timerContainer.children}}),Y=new CustomEvent(v.DRAG_END_EVENT_NAME,{detail:!0}),dispatchEvent(Y),n.next=52,t._storeDispatch(p.DELETE_LAYOUT_DATA,{elementId:c});case 52:return n.abrupt("return",Promise.resolve(L));case 53:case"end":return n.stop()}}),n)})))()},getElementPropsById:function(e){var t="app"===e?this.getStore().layoutData.elementId:e;return this.getStore().dynamicProps[t]||{}},syncSourceToApp:function(e){return this.$http({url:y.default.appSourceTemplateSyncToApp,data:{appId:+this.$route.query.id,templateIdentifier:e.includes(T.PUBLISH_TEMPLATE)?"public_".concat(e):e}})}},created:function(){},mounted:function(){var e=this;return(0,l.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.default.$on(E.HIGH_LIGHT,(function(t){e.$nextTick((function(){e.dndOptions.selectedId=t,e.$emit("selectedChanged")}))})),b.default.$on(E.UPDATE_DIALOG_TIMER,(function(t){var n=t.currentDialog,a=t.currentTimer;e.currentDialog=n,e.currentTimer=a})),t.next=4,e.$nextTick();case 4:e.handleInitDnD();case 5:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){document.removeEventListener("mouseover",this.handleMouseEnterCanvas),document.removeEventListener("click",this.handleSelectWidget),b.default.$off(E.HIGH_LIGHT),b.default.$off(E.UPDATE_DIALOG_TIMER),(0,h.default)(".drop-zone").unset(),(0,h.default)(".is-accept-drag").unset(),(0,h.default)(".is-resizable").unset()}};t.default=L},gART:function(e,t,n){"use strict";n("lr8n")},lr8n:function(e,t,n){var a=n("5XML");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("8f351d02",a,!0,{})},w53y:function(e,t,n){"use strict";n.r(t);var a=n("90IP"),i=n.n(a);for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);t.default=i.a}}]);
//# sourceMappingURL=/@project/web_code/83-941c78b42fca4defe959.js.map