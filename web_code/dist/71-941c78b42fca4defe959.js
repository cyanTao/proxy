(window["webpackJsonp_/@project/web_code"]=window["webpackJsonp_/@project/web_code"]||[]).push([[71],{"+1a3":function(e,t,n){var a=n("UFDT");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("06bf1109",a,!0,{})},"+wdO":function(e,t,n){"use strict";n.r(t);var a=n("Vo0m"),r=n("Jq3Z");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("W9jN");var o=n("KHd+"),s=Object(o.a)(r.default,a.a,a.b,!1,null,"3e177db0",null);t.default=s.exports},"1OIL":function(e,t,n){"use strict";n.r(t);var a=n("JT5l"),r=n("pB2c");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("BPeb");var o=n("KHd+"),s=Object(o.a)(r.default,a.a,a.b,!1,null,"0c62b0aa",null);t.default=s.exports},"4zaj":function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("n-tree",{ref:"nodeTree",staticClass:"node-tree",attrs:{data:e.data,"node-key":"elementId","expand-on-click-node":!1,"default-expand-all":"","highlight-current":"",draggable:!0,"allow-drop":e.allowDrop,"icon-class":"icon-right"},on:{"node-drag-end":e.saveAllTreeDatas},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.data;return n("div",{staticClass:"tree-node",class:{"is-selected":e.isSelected(a),"is-hide":e.isHide(a)},on:{click:function(t){return t.stopPropagation(),e.handleClick(a)}}},[n("div",{staticClass:"node-name"},[n("img",{staticClass:"node-icon",attrs:{src:e.$getImgPrefix(e.iconMap[a.elementType]),alt:""}}),e._v(" "),n("span",{attrs:{title:a.elementName}},[e._v(e._s(a.elementName))])]),e._v(" "),n("el-dropdown",{staticClass:"node-right-menu-icon",on:{command:function(t){return e.handleCommand(t,a)}}},[n("span",{staticClass:"el-dropdown-link",on:{click:function(e){e.stopPropagation()}}},[n("i",{staticClass:"el-icon-more el-icon--right"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{command:"edit"}},[e._v("编辑")]),e._v(" "),n("el-dropdown-item",{directives:[{name:"show",rawName:"v-show",value:0===a.children.length,expression:"data.children.length === 0"}],attrs:{command:"delete"}},[e._v("\n          删除\n        ")]),e._v(" "),n("el-dropdown-item",{attrs:{command:"hidden"}},[e._v("\n          "+e._s(a.hidden?"显示":"隐藏")+"\n        ")])],1)],1)],1)}}])})},r=[]},"587B":function(e,t,n){"use strict";n("v/r6")},"9Vgx":function(e,t,n){"use strict";n.r(t);var a=n("IKR+"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t.default=r.a},"Ak/T":function(e,t,n){},BPeb:function(e,t,n){"use strict";n("nU/a")},EUdC:function(e,t,n){},"IKR+":function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("Ff2n")),i=a(n("o0o1")),o=a(n("rePB")),s=a(n("HaE+")),d=a(n("KQm4")),l=a(n("slWK")),c=a(n("YLtl")),u=n("cCei"),p=n("ZDQs"),f=n("7C5+"),g=a(n("ZQwl")),h=n("vu0G"),m=["children"];function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){(0,o.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var y={name:"TreePanel",inject:(0,d.default)(f.pageInject),components:{},props:{data:{type:Array,required:!0},defaultSelect:{type:String}},data:function(){return{iconMap:p.iconMap,selectedId:""}},watch:{defaultSelect:{handler:function(e,t){var n=this;e&&this.$nextTick((function(){n.selectedId=e,n.$refs.nodeTree.setCurrentKey(e)}))},immediate:!0},data:function(){var e=this;this.$nextTick((function(){e.$refs.nodeTree.setCurrentKey(e.selectedId)}))}},methods:{handleCommand:function(e,t){switch(e){case"edit":this.toggleEdit(t);break;case"delete":this.toggleDelete(t);break;case"hidden":this.toggleHidden(t)}},handleClick:function(e){var t=this;return(0,s.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.elementId!==t.selectedId){n.next=2;break}return n.abrupt("return");case 2:if("page"===e.elementType){n.next=4;break}return n.abrupt("return");case 4:return n.next=6,t._storeDispatch(u.CONFIRM_SAVE_CONFIG);case 6:t.getPageConfig(e);case 7:case"end":return n.stop()}}),n)})))()},saveAllTreeDatas:function(){var e=this,t=c.default.cloneDeep(this.$refs.nodeTree.data),n=this.treeMap(t,0);this.$http({url:l.default.appPageDesignBatchUpdateTree,data:n}).then((function(t){e.$emit("handleTreeChange")}))},treeMap:function(e,t){var n=this;return e.reduce((function(e,a,r){var i={id:a.pageDesignId,name:a.elementName,sort:r,hidden:a.hidden,appDesignId:n.$route.query.vid,type:"page-group"===a.elementType?2:1,parentId:t};return a.code&&(i.code=a.code),a.children&&0!==a.children.length?e.concat(b(b({},i),{},{pages:n.treeMap(a.children,a.pageDesignId)})):e.concat(b(b({},i),{},{pages:[]}))}),[])},allowDrop:function(e,t,n){return"page"!==t.data.elementType&&("page-group"!==e.data.elementType||"page-group"!==t.data.elementType)||"inner"!==n},isSelected:function(e){return this.selectedId===e.elementId},isHide:function(e){return e.hidden},toggleHidden:function(e){this.$http({url:"page-group"==e.elementType?l.default.appPageDesignUpdateGroup:l.default.appPageDesignUpdatePage,data:{id:e.pageDesignId,hidden:!e.hidden,appDesignId:this.$route.query.vid}}).then((function(t){200==t.msgCode&&(e.hidden=!e.hidden,e.children.forEach((function(t){return t.hidden=e.hidden})))}))},toggleDelete:function(e){var t=this;return(0,s.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._storeDispatch(u.CONFIRM_SAVE_CONFIG);case 2:t.$confirm("确定删除该".concat("page-group"==e.elementType?"分组":"页面","吗？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1}).then((function(){t.$http({url:"page-group"==e.elementType?l.default.appPageDesignRemoveGroup:l.default.appPageDesignRemovePage,data:{id:e.pageDesignId}}).then((function(n){if(e.elementId===t.selectedId||e.children.map((function(e){return e.elementId})).includes(t.selectedId)){var a=t.data.reduce((function(e,t){var n=t.children,a=(0,r.default)(t,m);return"page"===t.elementType&&e.push(a),n&&n.length&&(e=e.concat(n.filter((function(e){return"page"===e.elementType})))),e}),[]);a.length?t.$emit("select",a[0]):(t.selectedId=void 0,t.$emit("select",null)),t.$emit("removeCache")}t.$emit("handleTreeChange")}))}));case 3:case"end":return n.stop()}}),n)})))()},toggleEdit:function(e){var t=this;return(0,s.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t._storeDispatch(u.CONFIRM_SAVE_CONFIG);case 2:t.$emit("handleTreeItemEdit",c.default.cloneDeep(e));case 3:case"end":return n.stop()}}),n)})))()},getPageConfig:function(e){var t=this;return(0,s.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=t.$loading({lock:!0,text:"正在请求最新配置"}),t.$emit("loading",!0),setTimeout((0,s.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t._storeDispatch(u.UPDATE_PAGE_CONFIG,{elementId:e.elementId,pageDesignId:e.pageDesignId,appDesignId:t.$route.query.vid}).then((function(){t.selectedId=e.elementId,t.$emit("select",e,!0)})).finally((function(){a.close()}));case 1:case"end":return n.stop()}}),n)}))),100);case 3:case"end":return n.stop()}}),n)})))()}},created:function(){var e=this;g.default.$on(h.SWITCH_PAGE,(function(t){e.handleClick(t)}))},destroyed:function(){g.default.$off(h.SWITCH_PAGE)}};t.default=y},JT5l:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"element-screen",rawName:"v-element-screen"}],staticClass:"group-modify",attrs:{"custom-class":"low-code-dialog","close-on-click-modal":!1,title:e.id?"修改分组":"新增分组",visible:e.visible,width:"800px",top:"5vh"},on:{"update:visible":function(t){e.visible=t},close:e.handleResetForm}},[n("n-form",{ref:"dataGroupForm",staticClass:"group-modify-form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("n-form-item",{attrs:{label:"分组名称",prop:"name"}},[n("el-input",{staticClass:"form-input",attrs:{placeholder:"请输入分组名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"排序",prop:"sort"}},[n("el-input-number",{model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"是否隐藏",prop:"hidden"}},[n("el-switch",{attrs:{"on-text":"隐藏","off-text":"显示"},model:{value:e.form.hidden,callback:function(t){e.$set(e.form,"hidden",t)},expression:"form.hidden"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSubmit}},[e._v("确 认\n    ")]),e._v(" "),n("el-button",{attrs:{loading:e.loading},on:{click:e.close}},[e._v("取 消")])],1)],1)},r=[]},Jp4C:function(e,t,n){},Jq3Z:function(e,t,n){"use strict";n.r(t);var a=n("iqUM"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t.default=r.a},Mv9o:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("o0o1")),i=a(n("HaE+")),o=a(n("KQm4")),s=a(n("slWK")),d=a(n("ndgR")),l=a(n("1OIL")),c=a(n("+wdO")),u=(n("29fP"),n("0O+R")),p=a(n("YLtl")),f=n("cCei"),g=a(n("/S23")),h=n("7C5+");var m={name:"PagePanel",components:{PageTree:d.default,GroupModify:l.default,PageModify:c.default},inject:["dndOptions"].concat((0,o.default)(h.pageInject)),data:function(){return{appId:this.$route.query.id,vid:this.$route.query.vid,groupId:0,pageId:0,loading:!1,selectedPage:{elementId:void 0,elementName:void 0},pageTree:[],groupModifyData:{},pageModifyData:{},keyword:""}},methods:{handlePageCache:function(e){var t=this.appId,n=this.vid,a="STORE_PAGE_KEY";try{var r=JSON.parse(localStorage.getItem(a)||"{}");if(!e)return r["".concat(t,"_").concat(n)];r["".concat(t,"_").concat(n)]=e,localStorage.setItem(a,JSON.stringify(r))}catch(e){return console.error("an error occured when get storage :"+e),!1}},handleRemoveCache:function(){var e=this.appId,t=this.vid,n="STORE_PAGE_KEY",a=JSON.parse(localStorage.getItem(n)||{});a["".concat(e,"_").concat(t)]="",localStorage.setItem(n,JSON.stringify(a))},pageSearch:function(e,t){var n=e?u.treeUtil.filter(this.pageTree,function(e){return function(t){return-1!==t.elementName.toLowerCase().indexOf(e.toLowerCase())}}(e)):this.pageTree;t(u.treeUtil.toList(n).filter((function(e){return"page"===e.elementType})))},handleSelect:function(e,t){var n=this;if(!e)return this.selectedPage={elementId:void 0,elementName:void 0},this.dndOptions.selectedId=void 0,void this._storeCommit(f.RESET_STORE);this.handlePageCache(e),t?(this.selectedPage=p.default.cloneDeep(e),this.dndOptions.selectedId=e.elementId,this.$nextTick((function(){n.$emit("page-load",!0)}))):this.getPageConfig(e)},getPageConfig:function(e){var t=this,n=this.$loading({lock:!0,text:"正在请求最新配置"});this.$emit("page-load",!1),setTimeout((function(){t._storeDispatch(f.UPDATE_PAGE_CONFIG,{elementId:e.elementId,pageDesignId:e.pageDesignId,appDesignId:t.vid}).then((function(){t.selectedPage=p.default.cloneDeep(e),t.dndOptions.selectedId=e.elementId,t.$emit("page-load",!0)})).finally((function(){n.close()}))}),100)},getPageTree:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.pageAdd,a=t.response,r=t.selectDefault,i=void 0!==r&&r;this.loading=!0,this.$http({url:s.default.appPageDesignTree,data:{appDesignId:this.vid}}).then((function(t){var r;if(e.pageTree=t.data.map((function(t){return e.treeMap(t,0)})),e.$store.commit(f.UPDATE_PAGE_DATA,{pageData:p.default.cloneDeep(u.treeUtil.toList(e.pageTree))}),n)return u.treeUtil.forEach(e.pageTree,(function(e){Number(e.pageDesignId)===a&&(r=e)})),void e.handleSelect(r);i&&e.$nextTick((function(){var t=e.handlePageCache();if(t)e.handleSelect(t);else{var n=!1;u.treeUtil.forEach(e.pageTree,(function(e){1!==e.type&&void 0!==e.type||n||(n=e)})),e.handleSelect(n)}}))})).finally((function(){e.loading=!1}))},treeMap:function(e,t){var n=this,a=e.pages&&e.pages.length>0;return{elementId:"".concat(e.code),pageDesignId:"".concat(e.id),elementType:2===e.type?"page-group":"page",hidden:e.hidden,sort:e.sort,elementName:e.name,parentId:t,code:e.code?e.code:"",children:a?e.pages.map((function(t){return n.treeMap(t,e.id)})):[],type:e.type}},handleAddFloder:function(e){var t=this;return(0,i.default)(r.default.mark((function n(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return n.next=3,t._storeDispatch(f.CONFIRM_SAVE_CONFIG);case 3:return n.next=5,t.$store.dispatch(g.default.VERSION_JUDGE);case 5:t.groupId=e,t.$nextTick((function(){t.$refs.groupModify.show()}));case 7:case"end":return n.stop()}}),n)})))()},handleAddPage:function(e){var t=this;return(0,i.default)(r.default.mark((function n(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=3;break}return n.next=3,t._storeDispatch(f.CONFIRM_SAVE_CONFIG);case 3:return n.next=5,t.$store.dispatch(g.default.VERSION_JUDGE);case 5:t.pageId=e,t.$nextTick((function(){t.$refs.pageModify.show()}));case 7:case"end":return n.stop()}}),n)})))()},handleTreeItemEdit:function(e){"page-group"===e.elementType?(this.groupModifyData=e,this.handleAddFloder(e.pageDesignId)):(this.pageModifyData=e,this.handleAddPage(e.pageDesignId))}},created:function(){this.getPageTree({selectDefault:!0})}};t.default=m},RblQ:function(e,t,n){var a=n("Ak/T");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("09df0a0f",a,!0,{})},S2cY:function(e,t,n){"use strict";n.r(t);var a=n("xjyE"),r=n("TmSo");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("587B");var o=n("KHd+"),s=Object(o.a)(r.default,a.a,a.b,!1,null,"09e3c1cb",null);t.default=s.exports},TmSo:function(e,t,n){"use strict";n.r(t);var a=n("Mv9o"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t.default=r.a},UFDT:function(e,t,n){},VY4q:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("o0o1")),i=a(n("rePB")),o=a(n("HaE+")),s=n("xBdn"),d=a(n("slWK"));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u={props:{id:{type:Number,required:!0,default:0},data:{type:Object,default:{}}},data:function(){return{vid:this.$route.query.vid,visible:!1,loading:!1,form:{name:"",sort:0,hidden:!1},rules:{name:(0,s.getValidators)([{message:"请输入分组名称",include:s.required,required:!0,trigger:"change"}])}}},methods:{setFormByProp:function(){this.form={name:this.data.elementName,sort:this.data.sort||0,hidden:this.data.hidden||!1}},handleSubmit:function(){var e=this;this.$refs.dataGroupForm.validate(function(){var t=(0,o.default)(r.default.mark((function t(n){var a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n&&(a=c(c({},e.form),{},{id:e.id,appDesignId:e.vid}),e.loading=!0,e.$http({url:e.id?d.default.appPageDesignUpdateGroup:d.default.appPageDesignSaveGroup,data:a}).then((function(t){200==t.msgCode&&(e.close(),e.$emit("success"),e.$message.success("操作成功"))})).finally((function(){e.loading=!1})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},handleResetForm:function(){this.$refs.dataGroupForm.resetFields()},show:function(){this.id&&this.setFormByProp(),this.visible=!0},close:function(){this.visible=!1}},computed:{},watch:{}};t.default=u},Vo0m:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{directives:[{name:"element-screen",rawName:"v-element-screen"}],staticClass:"page-modify",attrs:{"custom-class":"low-code-dialog","close-on-click-modal":!1,title:e.id?"修改页面":"新增页面",visible:e.visible,width:"800px",top:"5vh"},on:{"update:visible":function(t){e.visible=t},close:e.handleResetForm}},[n("n-form",{ref:"dataForm",staticClass:"page-modify-form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[e.id?e._e():[n("n-form-item",{attrs:{label:"新增模式"}},[n("el-radio-group",{attrs:{size:"small"},on:{change:e.handleModeChange},model:{value:e.createMode,callback:function(t){e.createMode=t},expression:"createMode"}},[n("el-radio-button",{attrs:{label:"1"}},[e._v("全新创建")]),e._v(" "),n("el-radio-button",{attrs:{label:"2"}},[e._v("从其他页面复制")])],1)],1),e._v(" "),2==e.createMode?[n("n-form-item",{attrs:{label:"选择页面"}},[n("el-select",{attrs:{filterable:""},on:{change:e.handleAppChange},model:{value:e.selectedAppId,callback:function(t){e.selectedAppId=t},expression:"selectedAppId"}},e._l(e.appList,(function(e){return n("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1),e._v(" "),n("el-select",{attrs:{filterable:"",disabled:!e.selectedAppId},on:{change:e.handleVersionChange},model:{value:e.selectedAppVersionId,callback:function(t){e.selectedAppVersionId=t},expression:"selectedAppVersionId"}},e._l(e.versionList,(function(e){return n("el-option",{key:e.version,attrs:{label:e.version,value:e.id}})})),1),e._v(" "),n("el-select",{attrs:{filterable:"",disabled:!e.selectedAppVersionId},on:{change:e.handlePageChange},model:{value:e.selectedPageId,callback:function(t){e.selectedPageId=t},expression:"selectedPageId"}},e._l(e.pageList,(function(e){return n("el-option",{key:e.pageDesignId,attrs:{label:e.elementName,value:e.pageDesignId}})})),1)],1)]:e._e()],e._v(" "),n("n-form-item",{attrs:{label:"页面名称",prop:"name"}},[n("el-input",{staticClass:"form-input",attrs:{placeholder:"请输入页面名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"分组",prop:"parentId"}},[n("Select",{staticClass:"form-select",attrs:{options:e.groupOptions,placeholder:"请选择分组"},on:{change:e.onChange},model:{value:e.form.parentId,callback:function(t){e.$set(e.form,"parentId",t)},expression:"form.parentId"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"排序",prop:"sort"}},[n("el-input-number",{model:{value:e.form.sort,callback:function(t){e.$set(e.form,"sort",t)},expression:"form.sort"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"是否隐藏",prop:"hidden"}},[n("el-switch",{attrs:{"on-text":"隐藏","off-text":"显示"},model:{value:e.form.hidden,callback:function(t){e.$set(e.form,"hidden",t)},expression:"form.hidden"}})],1)],2),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleSubmit}},[e._v("确 认\n    ")]),e._v(" "),n("el-button",{attrs:{loading:e.loading},on:{click:e.close}},[e._v("取 消")])],1)],1)},r=[]},W9jN:function(e,t,n){"use strict";n("+1a3")},iqUM:function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("o0o1")),i=a(n("rePB")),o=a(n("HaE+")),s=a(n("KQm4")),d=n("xBdn"),l=a(n("slWK")),c=a(n("Wk/A")),u=n("0O+R"),p=n("7C5+"),f=n("7Qib");function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={inject:(0,s.default)(p.pageInject),components:{Select:c.default},props:{id:{type:Number,required:!0,default:0},data:{type:Object,default:{}}},data:function(){return{vid:this.$route.query.vid,visible:!1,loading:!1,createMode:1,groupOptions:[],form:{name:"",sort:0,hidden:!1},allTree:[],rules:{name:(0,d.getValidators)([{message:"请输入页面名称",include:d.required,required:!0,trigger:"change"}])},selectedAppId:void 0,selectedAppVersionId:void 0,selectedPageId:void 0,appList:[],versionList:[],pageList:[]}},methods:{getGroupOptions:function(){var e=this;this.$http({url:l.default.appPageDesignTree,data:{appDesignId:this.vid}}).then((function(t){e.allTree=t.data,e.initSort(),e.allTree.some((function(t){2===t.type&&e.groupOptions.push({label:t.name,value:t.id})}))}))},setFormByProp:function(){this.form={name:this.data.elementName,sort:this.data.sort||0,hidden:this.data.hidden||!1,parentId:this.data.parentId||""}},handleSubmit:function(){var e=this;this.$refs.dataForm.validate(function(){var t=(0,o.default)(r.default.mark((function t(n){var a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=8;break}if(2!=e.createMode){t.next=5;break}if(e.selectedPageId){t.next=5;break}return e.$message.error("请选择复制的页面！"),t.abrupt("return");case 5:a=h(h({},e.form),{},{appDesignId:e.vid,id:e.id,sourcePageId:2==e.createMode?e.selectedPageId:void 0}),e.loading=!0,e.$http({url:e.id?l.default.appPageDesignUpdatePage:l.default.appPageDesignSavePage,data:a}).then((function(t){200==t.msgCode&&(e.close(),e.$emit("success",{pageAdd:!e.id,response:t.data}),e.$message.success("操作成功"),2==e.createMode&&e.handleRefreshAppVariables())})).finally((function(){e.loading=!1}));case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},handleResetForm:function(){this.$refs.dataForm.resetFields(),this.groupOptions=[],this.selectedAppId=void 0,this.selectedAppVersionId=void 0,this.selectedPageId=void 0,this.appList=[],this.versionList=[],this.pageList=[],this.createMode=1},show:function(){this.id&&this.setFormByProp(),this.visible=!0,this.getGroupOptions()},close:function(){this.visible=!1},onChange:function(e){this.initSort(e)},initSort:function(e){if(!this.id){var t,n,a=this.allTree,r=[];if(e)r=(null===(t=a.find((function(t){return t.id===e})))||void 0===t||null===(n=t.pages)||void 0===n?void 0:n.map((function(e){return e.sort})))||[];else r=a.map((function(e){return e.sort}));this.form.sort=r.length?Math.max.apply(this,r)+1:0}},handleModeChange:function(e){var t=this;return(0,o.default)(r.default.mark((function n(){return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(2!=e){n.next=9;break}return t.selectedAppId=Number(t.$route.query.id),t.selectedAppVersionId=Number(t.$route.query.vid),n.next=5,t.handleGetAppList();case 5:return n.next=7,t.getVersionList();case 7:return n.next=9,t.getPageList();case 9:case"end":return n.stop()}}),n)})))()},handleAppChange:function(e){e&&(this.selectedAppVersionId=void 0,this.selectedPageId=void 0,this.getVersionList())},handleVersionChange:function(e){e&&this.getPageList()},handlePageChange:function(e){e&&(this.form.name=this.pageList.find((function(t){return t.pageDesignId===e})).elementName)},handleGetAppList:function(){var e=this;return this.loading=!0,this.$http({url:l.default.appInfoPage,data:{condition:{categoryCode:"",keyword:""},pagination:{pagenum:1,pagesize:999,sort:{name:void 0,type:void 0},sorting:""}}}).then((function(t){var n=t.data,a=n.records;n.rowCount;e.appList=a})).finally((function(){e.loading=!1}))},getVersionList:function(){var e=this;return this.$http({url:l.default.appDesignList,data:{appId:this.selectedAppId}}).then((function(t){var n=t.data;e.versionList=n.reverse()}))},getPageList:function(){var e=this;return this.$http({url:l.default.appPageDesignTree,data:{appDesignId:this.selectedAppVersionId}}).then((function(t){var n=t.data.map((function(t){return e.treeMap(t,0)}));e.pageList=u.treeUtil.toList(n).filter((function(e){return"page"===e.elementType}))}))},treeMap:function(e,t){var n=this,a=e.pages&&e.pages.length>0;return{elementId:"".concat(e.code),pageDesignId:"".concat(e.id),elementType:2===e.type?"page-group":"page",hidden:e.hidden,sort:e.sort,elementName:e.name,parentId:t,code:e.code?e.code:"",children:a?e.pages.map((function(t){return n.treeMap(t,e.id)})):[],type:e.type}},handleRefreshAppVariables:function(){var e=this;return this.loading=!0,this.$http({url:l.default.appVariablesList,data:{appDesignId:Number(this.$route.query.vid)}}).then((function(e){var t=e.data.map((function(e){return[e.name,{value:"string"==typeof e.defaultValue&&(0,d.isValidJsonString)(e.defaultValue)?JSON.parse(e.defaultValue):e.defaultValue,desc:e.description,key:e.name}]})),n=Object.fromEntries(t);(0,f.setAppVariables)(n)})).finally((function(){e.loading=!1}))},getElementPropsById:function(e){var t="app"===e?this.getStore().layoutData.elementId:e;return this.getStore().dynamicProps[t]||{}}}};t.default=m},izRP:function(e,t,n){"use strict";n("RblQ")},"nU/a":function(e,t,n){var a=n("Jp4C");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("4555f3a1",a,!0,{})},ndgR:function(e,t,n){"use strict";n.r(t);var a=n("4zaj"),r=n("9Vgx");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("izRP");var o=n("KHd+"),s=Object(o.a)(r.default,a.a,a.b,!1,null,"f8d676d6",null);t.default=s.exports},pB2c:function(e,t,n){"use strict";n.r(t);var a=n("VY4q"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t.default=r.a},"v/r6":function(e,t,n){var a=n("EUdC");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("24eca534",a,!0,{})},xjyE:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return r}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"page-panel"},[n("div",{staticClass:"page-search-bar"},[n("el-autocomplete",{staticClass:"autocomplete",attrs:{size:"mini","popper-class":"my-autocomplete","fetch-suggestions":e.pageSearch,placeholder:"请输入页面名称"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return[n("div",{staticClass:"name"},[e._v(e._s(a.elementName))])]}}]),model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[n("i",{staticClass:"el-icon-search el-input__icon",attrs:{slot:"suffix"},slot:"suffix"})]),e._v(" "),n("div",{staticClass:"btn-group"},[n("img",{staticClass:"btn",attrs:{src:e.$getImgPrefix("/design/svg/eidt-add-page.svg")},on:{click:function(t){return e.handleAddPage(0)}}}),e._v(" "),n("img",{staticClass:"btn group",attrs:{src:e.$getImgPrefix("/design/svg/eidt-add-group.svg")},on:{click:function(t){return e.handleAddFloder(0)}}})])],1),e._v(" "),n("div",{staticClass:"page-tree"},[n("page-tree",{attrs:{data:e.pageTree,defaultSelect:e.selectedPage.elementId},on:{handleTreeChange:e.getPageTree,select:e.handleSelect,loading:function(t){return e.$emit("page-load",!1)},handleTreeItemEdit:e.handleTreeItemEdit,removeCache:e.handleRemoveCache}})],1),e._v(" "),n("group-modify",{ref:"groupModify",attrs:{id:e.groupId,data:e.groupModifyData},on:{success:e.getPageTree}}),e._v(" "),n("page-modify",{ref:"pageModify",attrs:{id:e.pageId,data:e.pageModifyData},on:{success:e.getPageTree}})],1)},r=[]}}]);
//# sourceMappingURL=/@project/web_code/71-941c78b42fca4defe959.js.map