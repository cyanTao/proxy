{"version":3,"sources":["webpack:///./src/components/CoverWrapper/index.vue","webpack:///src/components/CoverWrapper/index.vue","webpack:///./src/components/CoverWrapper/index.vue?7772","webpack:///./src/components/CoverWrapper/index.vue?04cb","webpack:///./src/components/CoverWrapper/index.vue?c4a7","webpack:///./src/components/CoverWrapper/index.vue?3b4f"],"names":["component","content","__esModule","default","module","i","locals","exports","add","render","_vm","this","_h","$createElement","_c","_self","staticClass","class","isResizable","isDragging","isDialog","style","isPage","isAcceptDrag","attrs","elementProps","_v","_s","elementName","$getImgPrefix","on","$event","stopPropagation","handleAddToFavorite","apply","arguments","_e","handleCopy","isTimer","handleToggleHidden","handleDelete","staticRenderFns"],"mappings":"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","file":"77-941c78b42fca4defe959.js","sourcesContent":["import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=3f81374b&scoped=true&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=3f81374b&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3f81374b\",\n  null\n  \n)\n\nexport default component.exports","<template>\n  <div\n    class=\"cover-wrapper\"\n    :class=\"{\n      'is-resizable': isResizable,\n      'is-dragging': isDragging,\n      'is-dialog': isDialog,\n    }\"\n    :style='wrapperStyle'\n  >\n    <div class=\"control-button-wrapper\" :class=\"{'is-page': isPage}\" :style='controllerStyle'>\n      <span class=\"component-name no-hover\" :class=\"{'is-accept-drag': isAcceptDrag}\" :data-zone=\"`${elementProps.elementId}_${elementProps.elementType}`\">{{ elementProps.elementName }}</span>\n      <div class=\"icon_container\" v-if=\"isShowFavorite\" title=\"保存为模板\">\n        <img :src=\"$getImgPrefix('/design/svg/save.svg')\"  @click.stop=\"handleAddToFavorite\">\n      </div>\n      <!-- <div class=\"icon_container\" v-if=\"isShowFavorite\">\n        <el-button size=\"mini\" type=\"danger\" icon=\"el-icon-plus\" title=\"保存为公共模板\" @click.stop=\"handleAddToPublish\"></el-button>\n      </div> -->\n      <div class=\"icon_container\" v-if=\"isShowCopy\" title=\"复制组件\">\n        <img :src=\"$getImgPrefix('/design/svg/com-copy.svg')\"  @click.stop=\"handleCopy\">\n      </div>\n      <div class=\"icon_container\" v-if=\"isDialog || isTimer\">\n        <i class=\"iconfont icon-kai\" @click.stop=\"handleToggleHidden\"></i>\n      </div>\n      <div class=\"icon_container\" v-if=\"isShowDelete\" title=\"删除组件\">\n        <img :src=\"$getImgPrefix('/design/svg/com-delete.svg')\" @click.stop=\"handleDelete\">\n      </div>\n    </div>\n    <template v-if=\"isResizable && !isDragging\">\n      <div\n        v-if=\"isShowResizableRight\"\n        class=\"resize-handle right no-hover\"\n        :data-zone=\"`${elementProps.elementId}_${elementProps.elementType}`\"\n      ></div>\n    </template>\n  </div>\n</template>\n\n<script>\n  import {\n    getNodeByElementId, getParentNodeByElementId, removeLayoutElement,\n  } from '@/utils/tree-utils'\n  import {\n    dialogTypes,\n    ignoreCopyTypes,\n    ignoreDeleteTypes,\n    ignoreDragTypes,\n  } from '@/config/widgets'\n  import {\n    DELETE_LAYOUT_DATA,\n    HANDLE_COPY,\n    TOGGLE_LAYOUT_VISIBLE,\n  } from '@/config/storeKey'\n  import { DRAG_END_EVENT_NAME } from '@/config/eventName'\n  import _ from 'lodash'\n  import { getGlobalConfig, update } from '@/renderer/tools/history'\n  import EventBus from '@/renderer/tools/eventBus'\n  import { HIGH_LIGHT } from '@/config/eventKey'\n  import { pageInject } from '@/renderer/tools/pageStore'\n\n  let currentDom\n  let container\n\n  export default {\n    name: 'CoverWrapper',\n    inject: ['dndOptions', ...pageInject],\n    data() {\n      return {\n        wrapperStyle: undefined,\n        controllerStyle: undefined,\n      }\n    },\n    computed: {\n      layoutData() {\n        return this.getStore().layoutData\n      },\n      dynamicProps() {\n        return this.getStore().dynamicProps\n      },\n      elementProps() {\n        return this.dynamicProps[this.dndOptions.selectedId] || {}\n      },\n      isDragging() {\n        return !!this.dndOptions.draggingWidget\n      },\n      isResizable() {\n        const parentNode = getParentNodeByElementId(this.layoutData, this.elementProps.elementId)\n        return parentNode && ['layout-container', 'form-container'].includes(parentNode.elementType)\n      },\n      isShowResizableLeft() {\n        return true\n      },\n      isShowResizableRight() {\n        return true\n      },\n      isShowCopy() {\n        return !ignoreCopyTypes.includes(this.elementProps.elementType) && !this.isInDynamicContainer\n      },\n      isShowDelete() {\n        return !ignoreDeleteTypes.includes(this.elementProps.elementType)\n      },\n      isDialog() {\n        return dialogTypes.includes(this.elementProps.elementType)\n      },\n      isTimer() {\n        return this.elementProps.elementType === 'timer'\n      },\n      isShowFavorite() {\n        return this.isShowCopy\n      },\n      isInDynamicContainer() {\n        const parentNode = getParentNodeByElementId(this.layoutData.children, this.elementProps.elementId)\n        return parentNode && ['dynamic-container'].includes(parentNode.elementType)\n      },\n      isAcceptDrag() {\n        return ![...ignoreDragTypes, ...dialogTypes, 'timer'].includes(this.elementProps.elementType) && !this.elementProps.isIgnoreDrag\n      },\n      isPage() {\n        return this.elementProps.elementType === 'page'\n      }\n    },\n    watch: {\n      'elementProps.elementId': {\n        handler(n, o) {\n          this.updateCurrentDom()\n        }\n      }\n    },\n    methods: {\n      handleUpdateWrapperStyle(isForce = false) {\n        if (isForce) {\n          const {elementId, elementType} = this.elementProps\n          container = document.getElementById('app-design-page-main')\n          currentDom = document.querySelector(`.page-canvas [data-zone=\"${elementId}_${elementType}\"]`)\n        }\n        if (this.isDragging) {\n          return\n        }\n        if (!currentDom) {\n          this.wrapperStyle = undefined\n          return\n        }\n        const {left: pLeft, top: pTop, width: pWidth} = container.getBoundingClientRect()\n        const {left: cLeft, top: cTop, width, height} = currentDom.getBoundingClientRect()\n        const left = cLeft - pLeft\n        const top = cTop - pTop\n        this.wrapperStyle = {left: `${left - 2}px`, top: `${top - 2}px`, width: `${width + 4}px`, height: `${height + 4}px`, display: 'block'}\n        if (cLeft - pLeft <= 50 && width < 120) {\n          this.controllerStyle = {\n            left: '0',\n            right: 'unset'\n          }\n        } else if ((cLeft + width) - (pLeft + pWidth) >= 10) {\n          const offsetRight = (cLeft + width) - (pLeft + pWidth)\n          this.controllerStyle = {\n            right: `${offsetRight}px`,\n            left: 'unset'\n          }\n        } else {\n          this.controllerStyle = undefined\n        }\n      },\n      loopUpdate() {\n        this.handleUpdateWrapperStyle()\n        clearTimeout(this.updateTimer)\n        this.updateTimer = setTimeout(() => {\n          this.loopUpdate()\n        }, 200)\n      },\n      async handleCopy() {\n        const oldCopyVal = getGlobalConfig.call(this)\n        const newElement = await this._storeDispatch(HANDLE_COPY, { elementId: this.elementProps.elementId })\n        update({\n          oldVal: this.elementProps.elementId,\n          val: newElement.elementId,\n          extra: {\n            oldVal: oldCopyVal,\n            val: getGlobalConfig.call(this)\n          },\n          callback: id => {\n            EventBus.$emit(HIGH_LIGHT, id)\n          }\n        })\n      },\n      handleAddToFavorite() {\n        this.$emit('addToFavorite', this.elementProps.elementId)\n      },\n      handleAddToPublish() {\n        this.$emit('addToPublish', this.elementProps.elementId)\n      },\n      handleToggleHidden() {\n        this._storeCommit(TOGGLE_LAYOUT_VISIBLE, { elementId: this.elementProps.elementId, isVisible: [true, undefined].includes(this.elementProps.isVisible) ? false : true })\n      },\n      handleDelete() {\n        removeLayoutElement.call(this, this.elementProps.elementId, this.layoutData.elementId)\n      },\n      updateCurrentDom() {\n        const id = this.elementProps.elementId\n        const type = this.elementProps.elementType\n        currentDom = document.querySelector(`.page-canvas [data-zone=\"${id}_${type}\"]`)\n      }\n    },\n    mounted() {\n      this.$nextTick(() => {\n        setTimeout(() => {\n          const {elementId, elementType} = this.elementProps\n          container = document.getElementById('app-design-page-main')\n          currentDom = document.querySelector(`.page-canvas [data-zone=\"${elementId}_${elementType}\"]`)\n          // todo: 需要优化更新触发时机\n          this.loopUpdate()\n          // const myObserver = new ResizeObserver(this.handleUpdateWrapperStyle)\n          // myObserver.observe(container)\n        })\n        window.addEventListener(DRAG_END_EVENT_NAME, this.updateCurrentDom)\n      })\n    },\n    beforeDestroy() {\n      clearTimeout(this.updateTimer)\n      window.removeEventListener(DRAG_END_EVENT_NAME, this.updateCurrentDom)\n    }\n  }\n</script>\n\n<style lang=\"less\" scoped>\n  @import '~@/styles/index.less';\n\n  .cover-wrapper::v-deep {\n    pointer-events: none;\n    display: none;\n    box-sizing: border-box;\n    position: absolute;\n    z-index: 200;\n    border: 2px solid @drop-main-color;\n    box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);\n\n    &.is-dragging {\n      display: none !important;\n    }\n\n    .control-button-wrapper {\n      pointer-events: auto;\n      position: absolute;\n      top: -5px;\n      right: 0;\n      transform: translate(1px, calc(-100% - 2px));\n      z-index: 100;\n      display: flex;\n      align-items: center;\n      background: #F0F6FF;\n      border-radius: 3px 3px 0 0;\n      padding: 0;\n      box-shadow: 0 2px 12px 0 rgba(0,0,0,0.1);\n      height: 30px;\n      &.is-page {\n        right: 36px;\n      }\n\n      .component-name {\n        min-width: 60px;\n        margin-right: 2px;\n        line-height: 30px;\n        text-align: center;\n        font-size: 13px;\n        font-weight: normal;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        white-space: nowrap;\n        color: #54A0FF;\n        padding: 0 4px;\n        &.is-accept-drag {\n          &:hover {\n            color: white;\n            cursor: grab;\n            background-color: #90c7ff;\n          }\n        }\n      }\n\n      .icon_container {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        height: 14px;\n        margin-right: 5px;\n        padding-top: 2px;\n        &:hover {\n          cursor: pointer;\n        }\n\n        .iconfont {\n          font-size: 13px;\n          font-weight: normal;\n          color: #54A0FF;\n        }\n      }\n    }\n\n    .resize-handle {\n      pointer-events: auto;\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 6px;\n      background: @drop-main-color;\n      overflow: hidden;\n      touch-action: none;\n      box-sizing: border-box;\n      user-select: none;\n\n      &.left {\n        left: -6px;\n      }\n\n      &.right {\n        right: -6px;\n      }\n    }\n  }\n</style>\n","// style-loader: Adds some css to the DOM by adding a <style> tag\n\n// load the styles\nvar content = require(\"!!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/less-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=3f81374b&lang=less&scoped=true&\");\nif(content.__esModule) content = content.default;\nif(typeof content === 'string') content = [[module.id, content, '']];\nif(content.locals) module.exports = content.locals;\n// add the styles to the DOM\nvar add = require(\"!../../../node_modules/vue-style-loader/lib/addStylesClient.js\").default\nvar update = add(\"620c4612\", content, true, {});","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"cover-wrapper\",class:{\n    'is-resizable': _vm.isResizable,\n    'is-dragging': _vm.isDragging,\n    'is-dialog': _vm.isDialog,\n  },style:(_vm.wrapperStyle)},[_c('div',{staticClass:\"control-button-wrapper\",class:{'is-page': _vm.isPage},style:(_vm.controllerStyle)},[_c('span',{staticClass:\"component-name no-hover\",class:{'is-accept-drag': _vm.isAcceptDrag},attrs:{\"data-zone\":((_vm.elementProps.elementId) + \"_\" + (_vm.elementProps.elementType))}},[_vm._v(_vm._s(_vm.elementProps.elementName))]),_vm._v(\" \"),(_vm.isShowFavorite)?_c('div',{staticClass:\"icon_container\",attrs:{\"title\":\"保存为模板\"}},[_c('img',{attrs:{\"src\":_vm.$getImgPrefix('/design/svg/save.svg')},on:{\"click\":function($event){$event.stopPropagation();return _vm.handleAddToFavorite.apply(null, arguments)}}})]):_vm._e(),_vm._v(\" \"),(_vm.isShowCopy)?_c('div',{staticClass:\"icon_container\",attrs:{\"title\":\"复制组件\"}},[_c('img',{attrs:{\"src\":_vm.$getImgPrefix('/design/svg/com-copy.svg')},on:{\"click\":function($event){$event.stopPropagation();return _vm.handleCopy.apply(null, arguments)}}})]):_vm._e(),_vm._v(\" \"),(_vm.isDialog || _vm.isTimer)?_c('div',{staticClass:\"icon_container\"},[_c('i',{staticClass:\"iconfont icon-kai\",on:{\"click\":function($event){$event.stopPropagation();return _vm.handleToggleHidden.apply(null, arguments)}}})]):_vm._e(),_vm._v(\" \"),(_vm.isShowDelete)?_c('div',{staticClass:\"icon_container\",attrs:{\"title\":\"删除组件\"}},[_c('img',{attrs:{\"src\":_vm.$getImgPrefix('/design/svg/com-delete.svg')},on:{\"click\":function($event){$event.stopPropagation();return _vm.handleDelete.apply(null, arguments)}}})]):_vm._e()]),_vm._v(\" \"),(_vm.isResizable && !_vm.isDragging)?[(_vm.isShowResizableRight)?_c('div',{staticClass:\"resize-handle right no-hover\",attrs:{\"data-zone\":((_vm.elementProps.elementId) + \"_\" + (_vm.elementProps.elementType))}}):_vm._e()]:_vm._e()],2)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js?cacheDirectory=true!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js?cacheDirectory=true!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","export * from \"-!../../../node_modules/vue-style-loader/index.js!../../../node_modules/mini-css-extract-plugin/dist/loader.js!../../../node_modules/css-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/less-loader/dist/cjs.js!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=3f81374b&lang=less&scoped=true&\""],"sourceRoot":""}