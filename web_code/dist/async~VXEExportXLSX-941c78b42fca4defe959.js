(window["webpackJsonp_/@project/web_code"]=window["webpackJsonp_/@project/web_code"]||[]).push([[65],{VzQU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.VXETablePluginExportXLSX=void 0;var r=a(n("0/eM")),o=a(n("EUZL"));function a(e){return e&&e.__esModule?e:{default:e}}function s(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r!==e.length;++r)n[r]=255&e.charCodeAt(r);return t}function i(e){var t=e.childNodes;return t&&t.length?i(t[0]):e}function u(e){var t="xlsx",n=e.$table,a=e.options,u=e.columns,c=e.colgroups,l=e.datas,f=n.$vxe,d=f.modal,p=f.t,v=a.message,m=a.sheetName,g=a.isHeader,h=a.isFooter,b=a.isMerge,x=a.isColgroup,w=a.original,y=!1!==v,_=n.getMergeCells(),E=[],k=[],S=[],T=[];if(g){var N={};u.forEach((function(e){N[e.id]=w?e.property:e.getTitle(),S.push({wpx:r.default.toInteger(.75*e.renderWidth)})})),x&&!w&&c?c.forEach((function(e,t){var n={};u.forEach((function(e){n[e.id]=null})),e.forEach((function(e){var r=e._colSpan,o=e._rowSpan,a=i(e),s=u.indexOf(a);n[a.id]=w?a.property:e.getTitle(),(r>1||o>1)&&T.push({s:{r:t,c:s},e:{r:t+o-1,c:s+r-1}})})),E.push(n)})):E.push(N)}b&&!w&&_.forEach((function(e){for(var t=e.row,r=e.rowspan,o=e.col,a=e.colspan,s=0;s<l.length;s++){var i=n.getVTRowIndex(l[s]._row);if(i===t){g&&c&&(i=s+c.length),T.push({s:{r:i,c:o},e:{r:i+r-1,c:o+a-1}});break}}}));var X=l.map((function(e){var t={};return u.forEach((function(n){t[n.id]=function(e,t){if(t)switch(e.cellType){case"string":break;case"number":if(!isNaN(t))return Number(t);break;default:if(t.length<12&&!isNaN(t))return Number(t)}return t}(n,e[n.id])})),t}));if(h){var $=n.getTableData().footerData,j=function(e,t){var n=e.footerFilterMethod;return n?t.filter((function(e,t){return n({items:e,$rowIndex:t})})):t}(a,$);j.forEach((function(e){var t={};u.forEach((function(r){t[r.id]=function(e,t,n,r){return n[e.$getColumnIndex(r)]}(n,0,e,r)})),k.push(t)}))}var B=function(){var n=o.default.utils.book_new(),r=(g?E:[]).concat(X).concat(k),i=o.default.utils.json_to_sheet(r.length?r:[{}],{skipHeader:!0});i["!cols"]=S,i["!merges"]=T,o.default.utils.book_append_sheet(n,i,m);var u=o.default.write(n,{bookType:"xlsx",bookSST:!1,type:"binary"}),c=new Blob([s(u)],{type:"application/octet-stream"});!function(e,t,n){var r=e.$table.$vxe,o=r.modal,a=r.t,s=n.message,i=n.filename,u=n.type,c=!1!==s;if(window.Blob)if(navigator.msSaveBlob)navigator.msSaveBlob(t,"".concat(i,".").concat(u));else{var l=document.createElement("a");l.target="_blank",l.download="".concat(i,".").concat(u),l.href=URL.createObjectURL(t),document.body.appendChild(l),l.click(),document.body.removeChild(l)}else c&&o.alert({message:a("vxe.error.notExp"),status:"error"})}(e,c,a),y&&(d.close(t),d.message({message:p("vxe.table.expSuccess"),status:"success"}))};y?(d.message({id:t,message:p("vxe.table.expLoading"),status:"loading",duration:-1}),setTimeout(B,1500)):B()}function c(e){if("xlsx"===e.options.type)return function(e){var t=e.$table,n=e.columns,a=e.options,s=e.file,i=t.$vxe,u=t._importResolve,c=t._importReject,l=i.modal,f=i.t,d=!1!==a.message,p=new FileReader;p.onload=function(e){var s=[];n.forEach((function(e){var t=e.property;t&&s.push(t)}));var i=o.default.read(e.target.result,{type:"binary"}),p=o.default.utils.sheet_to_json(r.default.first(i.Sheets)),v=p?r.default.keys(p[0]):[],m=p,g=function(e,t){return t.some((function(t){return e.indexOf(t)>-1}))}(s,v);if(g){var h=m.map((function(e){var t={};return s.forEach((function(n){t[n]=r.default.isUndefined(e[n])?null:e[n]})),t}));t.createData(h).then((function(e){return("insert"===a.mode?t.insertAt(e,-1):t.reloadData(e)).then((function(){u&&u({status:!0})}))})),d&&l.message({message:f("vxe.table.impSuccess",[h.length]),status:"success"})}else d&&l.message({message:f("vxe.error.impFields"),status:"error"}),c&&c({status:!1})},p.readAsBinaryString(s)}(e),!1}function l(e){if("xlsx"===e.options.type)return u(e),!1}var f={install:function(e){var t=e.interceptor;e.setup({export:{types:{xlsx:0}}}),t.mixin({"event.import":c,"event.export":l})}};t.VXETablePluginExportXLSX=f,"undefined"!=typeof window&&window.VXETable&&window.VXETable.use(f);var d=f;t.default=d}}]);
//# sourceMappingURL=/@project/web_code/async~VXEExportXLSX-941c78b42fca4defe959.js.map