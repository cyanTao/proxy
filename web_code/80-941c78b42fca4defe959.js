(window["webpackJsonp_/@project/web_code"]=window["webpackJsonp_/@project/web_code"]||[]).push([[80],{"+40o":function(e,t,n){"use strict";var a=n("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=a(n("o0o1")),i=a(n("ODXe")),l=a(n("HaE+")),r=a(n("KQm4")),s=a(n("x/Cv")),c=n("xBdn"),d=n("0O+R"),u=a(n("YLtl")),m=n("8SHQ"),f=n("7Qib"),p=a(n("cLAn")),g=n("ZDQs"),h=n("tgb1"),b=a(n("0hJt")),v=n("cCei"),y=n("7C5+");var _={inject:(0,r.default)(y.pageInject),components:{Upload:s.default},data:function(){return{dialogVisible:!1,title:"",loading:!1,form:{name:"",icon:"",description:"",config:void 0,id:0,type:"",thumb:""},thumbDataUrl:"",thumbData:null,versionList:[],rules:{name:(0,c.getValidators)([{message:"请输入模板名称",include:c.required,required:!0,trigger:"change"}]),icon:(0,c.getValidators)([{message:"请选择模板图标",include:c.required,required:!0,trigger:"change"}])},showUploadBtn:!1,buildThumbLoading:!1,newElementId:""}},computed:{thumbUrl:function(){return this.form.thumb?this.form.thumb:this.thumbDataUrl}},methods:{getImageUrl:f.getImageUrl,open:function(){var e=arguments,t=this;return(0,l.default)(o.default.mark((function n(){var a,l,s,c,f,p,b,y,_,w,D,T,x,I,S,E,U,L,N,k,O,C,V,j,B,$,J,A,F,P,q,G;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:{},l=a.elementId,s=a.data,t.title=l?"新增模板":"修改模板",!l){n.next=38;break}return n.next=5,t._storeDispatch(v.HANDLE_COPY,{elementId:l});case 5:c=n.sent,f=c.elementId,t.newElementId=f,p=(0,d.getNodeByElementId)(t.getStore().layoutData,f),b=g.dialogTypes.includes(p.elementType)?void 0:(0,d.getNodeByElementId)(t.getStore().layoutData,"dialog-container").children,y="timer"!==p.elementType?(0,d.getNodeByElementId)(t.getStore().layoutData,"timer-container").children:void 0,t.handleBuildThumb(l),_={},w={},d.treeUtil.forEach([p].concat((0,r.default)(b||[]),(0,r.default)(y||[])),(function(e){_[e.elementId]=t.getStore().eventsData[e.elementId],w[e.elementId]=t.getElementPropsById(e.elementId)})),D=JSON.stringify({events:_,props:w}),T=new RegExp("".concat(m.FUNCTION_FLAG,".{12}"),"g"),x=new RegExp("".concat(m.JS_FLAG,".{12}"),"g"),I=D.match(T)||[],S=t.getStore().functionsData.filter((function(e){return I.includes("".concat(m.FUNCTION_FLAG).concat(e.id))})),E=JSON.stringify(S),U=E.match(x)||[],L=t.getStore().jsData.filter((function(e){return U.includes("".concat(m.JS_FLAG).concat(e.id))})),N=t.getStore().dynamicProps[t.getStore().layoutData.elementId],k=N.dynamicVariables,O=N.appVariables,C=JSON.stringify({events:_,props:w,functionsData:S,jsData:L}),V=/(?<=(\$dynamicVariables\.)).*?(?=(\.value))/g,j=/(?<=(\$appVariables\.)).*?(?=(\.value))/g,B=C.match(V)||[],$=C.match(j)||[],J={},A={},Object.keys(k||{}).forEach((function(e){B.includes(e)&&(J[e]=u.default.cloneDeep(k[e]))})),Object.keys(O||{}).forEach((function(e){$.includes(e)&&(A[e]=u.default.cloneDeep(O[e]))})),F=JSON.stringify({layout:p,events:_,props:w,functionsData:S,jsData:L,dialogs:b,timers:y,dynamicVariables:J,appVariables:A,pageId:t.getStore().layoutData.elementId}),t.form.config=F,t.form.type=p.elementType,n.next=45;break;case 38:t.form.name=s.name,t.form.description=s.description,t.form.icon=s.icon,t.form.config=s.config,t.form.id=s.id,t.form.type=s.type,t.form.thumb=s.thumb;case 45:P=JSON.parse(t.form.config),q=d.treeUtil.toList([P.layout]).concat([].concat((0,r.default)(P.dialogs||[]),(0,r.default)(P.timers||[]))),G="__split__",t.versionList=u.default.uniq(q.map((function(e){return"".concat(e.elementType).concat(G).concat(e.elementVersion)}))).map((function(e){var n=e.split(G),a=(0,i.default)(n,2),o=a[0],l=a[1];return{elementName:h.getPropsValues.call(t,{elementType:o,elementVersion:l}).elementName,elementVersion:l}})),t.dialogVisible=!0,t.$nextTick((function(){t.$refs.dataForm.clearValidate()}));case 51:case"end":return n.stop()}}),n)})))()},close:function(){this.clear()},handleClose:function(e){this.clear(),e()},handleBuildThumb:function(e){var t=this;this.buildThumbLoading=!0,setTimeout((function(){var n=b.default.getRef(e).$el;p.default.toJpeg(n,{bgcolor:"#ffffff",quality:.9,style:{margin:"0"}}).then((function(e){t.form.thumb=e})).catch((function(e){t.showUploadBtn=!0})).finally((function(){t.buildThumbLoading=!1}))}))},clear:function(){this.newElementId&&this._storeDispatch(v.DELETE_LAYOUT_DATA,{elementId:this.newElementId}),this.form={name:"",icon:"",description:"",config:void 0,id:0,type:"",thumb:""},this.newElementId="",this.thumbDataUrl="",this.thumbData=null,this.loading=!1,this.dialogVisible=!1,this.showUploadBtn=!1,this.buildThumbLoading=!1},handleSubmit:function(){var e=this;return(0,l.default)(o.default.mark((function t(){var n;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$refs.dataForm.validate();case 2:e.loading=!0,(n=u.default.cloneDeep(e.form)).public=!0,n.id="".concat(m.PUBLISH_TEMPLATE).concat((0,d.getRandomHexadecimal)(6)),(0,f.downLoadFiles)(n,"".concat(n.name,".json")),e.$message.success("将下载的文件放置到src/config/widgetTemplate文件夹下，刷新页面即可"),e.$nextTick((function(){e.loading=!1}));case 9:case"end":return t.stop()}}),t)})))()},getElementPropsById:function(e){var t="app"===e?this.getStore().layoutData.elementId:e;return this.getStore().dynamicProps[t]||{}},handleThumbChange:function(e){this.form.thumb=e,this.showUploadBtn=!e}}};t.default=_},"5yUD":function(e,t,n){var a=n("NGS3");a.__esModule&&(a=a.default),"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n("SZ7m").default)("01f259f7",a,!0,{})},NGS3:function(e,t,n){},Ootm:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-dialog",{staticClass:"data-select-dialog",attrs:{"custom-class":"low-code-dialog",title:e.title,visible:e.dialogVisible,"close-on-click-modal":!1,"modal-append-to-body":!0,"append-to-body":!0,width:"800px",top:"15vh","before-close":e.handleClose}},[n("n-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"dataForm",staticClass:"create-form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("n-form-item",{attrs:{label:"模板名称",prop:"name"}},[n("el-input",{staticClass:"form-input",attrs:{placeholder:"请输入模板名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"模板图标",prop:"icon"}},[n("Upload",{ref:"upload",staticClass:"app-icon",attrs:{isBase64:!0},model:{value:e.form.icon,callback:function(t){e.$set(e.form,"icon",t)},expression:"form.icon"}}),e._v(" "),n("div",{staticClass:"app-icon-desc"},[e._v("\n        支持格式为jpg、png、jpeg、bmp，像素120*120，大小不超过1M\n      ")])],1),e._v(" "),n("n-form-item",{attrs:{label:"组件预览",prop:"thumb"}},[n("el-image",{directives:[{name:"loading",rawName:"v-loading",value:e.buildThumbLoading,expression:"buildThumbLoading"}],staticStyle:{width:"100%",height:"100px"},attrs:{src:e.thumbUrl,"preview-src-list":[e.thumbUrl],fit:"contain"}}),e._v(" "),e.showUploadBtn?n("el-button",{on:{click:function(t){e.$refs.upload2.$refs[e.$refs.upload2.refName].click()}}},[e._v("手动上传")]):e._e(),e._v(" "),n("Upload",{ref:"upload2",staticStyle:{display:"none"},attrs:{isBase64:!0},on:{change:e.handleThumbChange},model:{value:e.form.thumb,callback:function(t){e.$set(e.form,"thumb",t)},expression:"form.thumb"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"模板描述",prop:"description"}},[n("el-input",{staticClass:"form-textarea",attrs:{placeholder:"请输入模板描述",type:"textarea",rows:4,maxlength:"120","show-word-limit":""},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),e._v(" "),n("n-form-item",{attrs:{label:"包含组件"}},e._l(e.versionList,(function(t){return n("div",{key:t.elementName,staticClass:"version-item"},[n("el-tag",{staticClass:"version-version"},[e._v(e._s(t.elementName)+"-"+e._s(t.elementVersion))])],1)})),0)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{loading:e.loading||!e.thumbUrl,type:"primary"},on:{click:e.handleSubmit}},[e._v("确 认\n    ")]),e._v(" "),n("el-button",{attrs:{loading:e.loading},on:{click:e.close}},[e._v("取 消")])],1)],1)},o=[]},gDQc:function(e,t,n){"use strict";n.r(t);var a=n("+40o"),o=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t.default=o.a},jTEY:function(e,t,n){"use strict";n("5yUD")},pZPq:function(e,t,n){"use strict";n.r(t);var a=n("Ootm"),o=n("gDQc");for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n("jTEY");var l=n("KHd+"),r=Object(l.a)(o.default,a.a,a.b,!1,null,"709c1b05",null);t.default=r.exports}}]);
//# sourceMappingURL=/@project/web_code/80-941c78b42fca4defe959.js.map